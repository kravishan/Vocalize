<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="results.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="fonts/css/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="bootstrap.css">

    <link rel="stylesheet" type="text/css" href="bootstrap.css">
    <link rel="stylesheet" type="text/css" href="results.css">

    <!-- Add Firebase scripts using the script tag method -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <div class="page-title page-title-fixed">
		<a href="#" class="page-title-icon shadow-xl bg-theme color-theme me-0 ms-3 back-button"><i class="fa fa-arrow-left"></i></a>
		<h1 class="font-22">Result Page</h1>
		<a href="#" class="page-title-icon shadow-xl show-on-theme-light dark-button"><i class="fa fa-moon"></i></a>
        <a href="#" class="page-title-icon shadow-xl show-on-theme-dark white-button"><i class="fa fa-lightbulb color-yellow-dark"></i></a>
	</div>
	<div class="page-title-clear"></div>

    <div class="container"></div>

    <div id="voiceReviewOutput" class="resultOutput"></div>
    <div class="card card-style mt-5">
        <div class="content mb-3">
            <h4 class="centered-heading">Voice review</h4>
            <p id="voiceReviewText" class="mb-3"></p>
        </div>  
    </div>

    <div id="improvedReviewOutput" class="resultOutput"></div>
    <div class="card card-style mt-5">
        <div class="content mb-3">
            <h4 class="centered-heading">Improved review</h4>
            <p id="improvedReviewText" class="mb-3"></p>
        </div>  
    </div>

    <div id="improvedReviewWithStarsOutput" class="resultOutput"></div>
    <div class="card card-style mt-5">
        <div class="content mb-3">
            <h4 class="centered-heading">Improved review with stars</h4>
            <p id="improvedReviewWithStarsText" class="mb-3"></p>
        </div>  
    </div>
</div>

    <div id="dateandtimeOutput" class="resultOutput"></div>     
       
    <button id="saveButton" onclick="saveToFirestore()" class="button">Save Result</button>
    <button onclick="goBack()" class="button">Cancel</button></div>
    <div id="toast" class="toast"></div>

    <div class="card card-style mt-5">
        <div class="content mb-3">
            <h4>Modal Timed Info Alerts</h4>
            <p>
                Beautiful and small messages to inform your users an actions has sucessfully taken place!
            </p>
            <div class="list-group list-custom-small list-icon-0">
                <a href="#" data-menu="timed-1">
                    <i class="fa font-17 fa-check-circle color-green-dark"></i>
                    <span>Success / Ok</span>
                    <i class="fa fa-angle-right"></i>
                </a>        
                <a href="#" data-menu="timed-2">
                    <i class="fa font-17 fa-times-circle color-red-dark"></i>
                    <span>Failed / Error</span>
                    <i class="fa fa-angle-right"></i>
                </a>        
                <a href="#" data-menu="timed-3">
                    <i class="fa font-17 fa-shopping-bag color-brown-dark"></i>
                    <span>Added to Cart</span>
                    <i class="fa fa-angle-right"></i>
                </a>        
                <a href="#" data-menu="timed-4" class="border-0">
                    <i class="fa font-17 fa-bookmark color-red-dark"></i>
                    <span>Bookmarked</span>
                    <i class="fa fa-angle-right"></i>
                </a>        
            </div>
        </div>  
    </div>
    
    <div data-menu-load="menu-footer.html"></div>
</div>
<!-- Page content ends here-->

<div id="timed-1" 
     class="menu menu-box-modal rounded-m" 
     data-menu-hide="1000"
     data-menu-width="220"
     data-menu-height="160">
     <h1 class="text-center fa-5x mt-2 pt-3 pb-2"><i class="fa fa-check-circle color-green-dark"></i></h1>
     <h2 class="text-center">Success</h2>
</div>

<div id="timed-2" 
     class="menu menu-box-modal rounded-m" 
     data-menu-hide="1000"
     data-menu-width="220"
     data-menu-height="160">
     <h1 class="text-center fa-5x mt-2 pt-3 pb-2"><i class="fa fa-times-circle color-red-dark"></i></h1>
     <h2 class="text-center">Task Failed</h2>
</div>

<div id="timed-3" 
     class="menu menu-box-modal rounded-m" 
     data-menu-hide="1000"
     data-menu-width="220"
     data-menu-height="160">
     <h1 class="text-center fa-5x mt-2 pt-3 pb-2"><i class="fa fa-shopping-bag color-brown-dark"></i></h1>
     <h2 class="text-center">Added to Cart</h2>
</div>

<div id="timed-4" 
     class="menu menu-box-modal rounded-m" 
     data-menu-hide="1000"
     data-menu-width="220"
     data-menu-height="160">
     <h1 class="text-center fa-5x mt-2 pt-3 pb-2"><i class="fa fa-bookmark color-red-dark"></i></h1>
     <h2 class="text-center">Bookmarked</h2>
</div>

    <script>
        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB9GNhQGsnfy85gM9u_dJuOKWAZqPUdk44",
            authDomain: "vocalize-dc445.firebaseapp.com",
            projectId: "vocalize-dc445",
            storageBucket: "vocalize-dc445.appspot.com",
            messagingSenderId: "50867328520",
            appId: "1:50867328520:web:81681fc6f1baaae8b823bd"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get a reference to the Firestore database
        const db = firebase.firestore();

        // Function to navigate back to the previous page
        function goBack() {
            window.history.back();
        }
        
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const whisperText = urlParams.get('whisperText');
        const overallStarCount = urlParams.get('overallStarCount');
        const foodRating = urlParams.get('foodRating');
        const serviceRating = urlParams.get('serviceRating');
        const atmosphereRating = urlParams.get('atmosphereRating');
        const improvedReview = localStorage.getItem('improvedReview');
        const improvedReviewWithStars = urlParams.get('improvedReviewWithStars');

        // Get or set the generated date and time
        let generatedDateTime = localStorage.getItem('generatedDateTime');

        if (!generatedDateTime) {
            generatedDateTime = new Date().toLocaleString();
            localStorage.setItem('generatedDateTime', generatedDateTime);
        }

        // Function to generate star icons based on the rating
        function getStarRating(rating) {
            const stars = '\u2605'; // Unicode character for a solid star
            return stars.repeat(parseInt(rating));
        }

        // Function to save data to Firestore
        function saveToFirestore() {
            // Get the result data
            const resultData = {
                whisperText: whisperText,
                overallStarCount: overallStarCount,
                foodRating: foodRating,
                serviceRating: serviceRating,
                atmosphereRating: atmosphereRating,
                improvedReview: improvedReview,
                improvedReviewWithStars: improvedReviewWithStars,
                generatedDateTime: generatedDateTime,
            };

            // Add a new document with a generated ID to the 'results' collection
            db.collection('results')
                .add(resultData)
                .then((docRef) => {
                    console.log('Document written with ID:', docRef.id);
                    showSuccessMessage();
                })
                .catch((error) => {
                    console.error('Error adding document:', error);
                    showFailedMessage();
                });
        }

        // Function to show success or failure messages
        function showSuccessMessage() {
            const successMsg = document.getElementById('success-msg');
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        function showFailedMessage() {
            const failedMsg = document.getElementById('failed-msg');
            failedMsg.style.display = 'block';
            setTimeout(() => {
                failedMsg.style.display = 'none';
            }, 3000);
        }
        // Display the data on the page
        document.getElementById('voiceReviewText').innerHTML = `${whisperText}`;
        document.getElementById('improvedReviewText').innerHTML = `${improvedReview}`;
        document.getElementById('improvedReviewWithStarsText').innerHTML = `${decodeURIComponent(improvedReviewWithStars)}`;
        document.getElementById('dateandtimeOutput').innerHTML = `<strong>Generated Date and Time:</strong> ${generatedDateTime}`;
    </script>
    <script type="text/javascript" src="scripts/bootstrap.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="custom.js"></script>
</body>
</html>
